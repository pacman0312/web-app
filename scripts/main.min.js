const touchScreen=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),app=document.getElementById("app"),windowWidth=document.documentElement.clientWidth,windowHeight=document.documentElement.clientHeight,breakpointWidth=500,hideAppLog="-- Hide app",showAppLog="-- Show app",contentApp={main:{goods:{title:"Выбирай и готовь",seeAll:{text:"смотреть все",icon:"&rarr;"},loading:"images/loading.png",choose:"Выбрать"}},back:{icon:"images/icons/back.svg"},form:{timeText:"время готвки:",title:"Необходимые продукты",nothing:"из продуктов все есть",submit:"#",submitBtnText:"Отправить"}},hideApp=()=>{app.style.transition="all .3s ease 0s",app.style.opacity="0",app.style.visibility="hidden",console.log(hideAppLog)},showApp=()=>{app.style.opacity="1",app.style.visibility="visible",console.log(showAppLog)},resizeApp=(e,t)=>{windowWidth>500?e():t()},lazyLoading=(e,t,o,n)=>{const s=document.querySelectorAll(t);let i=[];const a=e=>{let t=i.findIndex(t=>e>t-o);if(t>=0){s[t].dataset.src&&setTimeout(()=>{s[t].classList.add("active"),s[t].src=s[t].dataset.src,s[t].removeAttribute("data-src")},200),delete i[t]}};if(s.length>0)for(const e of s){let t=e.dataset.src;"x"===n?t&&(i.push(e.getBoundingClientRect().left+pageXOffset),a(pageXOffset)):"y"===n&&t&&(i.push(e.getBoundingClientRect().top+pageYOffset),a(pageYOffset))}e.addEventListener("scroll",(function(e){if(s.length>0)if("x"===n){const t=e.target.scrollLeft;a(t)}else if("y"===n){const t=e.target.scrollTop;a(t)}}))},appBack=(e,t)=>{e.insertAdjacentHTML("beforeend",`\n        <div class="app-touch-back">\n            <div class="app-touch-back__wrap">\n                <div class="app-touch-back__icon">\n                    <img src="${contentApp.back.icon}" alt="iconBack">\n                </div>\n                <h2 class="app-touch-back__title">${t}</h2>\n            </div>\n        </div>\n    `)},appGetData=async(e,t)=>{if(void 0===t){const t=await fetch(e);if(!t.ok)throw new Error(`in url: ${t.url} Status: ${t.status}`);return await t.json()}{const o=t.parentElement;o.classList.add("expectation");const n=await fetch(e);if(!n.ok)throw new Error(`in url: ${n.url} Status: ${n.status}`);return setTimeout(()=>{o.classList.remove("expectation")},1e3),await n.json()}},createElements=(e,t,o,n)=>{const s=document.createElement(t);return s.className=o,e.insertAdjacentElement(n,s),s},createAppTouch=(e,t,o,n,s)=>t(e,o,n,s),createAppTouchMain=(e,t,o,n,s,i)=>{const a=t(e,o,n,s),c=`\n        <div class="app-touch-main__scroll">\n            <section class="app-touch-main__section app-touch-main__section_goods">\n                <h1 class="app-touch-title app-touch-title_goods">${i.goods.title}</h1>\n                <div class="app-touch-main__goods goods">\n                    <div class="goods__see-all">\n                        <span id="see-all-goods">${i.goods.seeAll.text}</span>\n                    </div>\n                    <div class="goods__wrap-scroll">\n                        <div class="goods__scroll after"></div>\n                    </div>\n                </div>\n            </section>\n        </div>\n    `;return a.insertAdjacentHTML(s,c),a},createAppTouchGoods=(e,t,o,n,s)=>{const i=t(e,o,n,s);return i.insertAdjacentHTML(s,'<div class="app-touch-good__scroll"></div>'),i},createAppTouchForm=(e,t,o,n,s,i)=>{const a=t(e,o,n,s),c=`\n        <div class="app-touch-form__close"></div>\n        <div class="app-touch-form__wrap-form">\n            <div class="app-touch-form__swipe"></div>\n            <form action="${i.submit}" id="form" class="form">\n                <input class="form__name-submit" type="text" name="name" value="">\n                <input class="form__ingredients-submit" type="text" name="ingredients" value="">\n                <div class="form__good"></div>\n                <div class="form__title">\n                    <h2>${i.title}</h2>\n                </div>\n                <div class="form__ingredients"></div>\n                <div class="form__btn">\n                    <button class="form__btn-submit cursor-none" type="submit">${i.submitBtnText}</button>\n                </div>\n            </form>\n        </div>\n    `;return a.insertAdjacentHTML(s,c),a},openForm=(e,t,o,n,s,i,a,c,d,l,r,p)=>{n.setAttribute("value",c),t.insertAdjacentHTML("beforeend",`\n        <div class="form__good-img">\n            <img src="${l}" alt="formGoodImg">\n        </div>\n        <div class="form__good-wrap">\n            <div class="form__good-name">${a}</div>\n            <div class="form__good-time">${p.timeText+" "+r}</div>\n        </div>\n    `);const m=d.split(", ");for(const e of m)i.insertAdjacentHTML("beforeend",`\n            <div class="form__ingredient-el">\n                <span class="form__ingredient-chec"></span>\n                <span class="form__ingredient-name">${e}</span>\n            </div>\n        `);i.insertAdjacentHTML("beforeend",`\n        <div class="form__ingredient-el nothing">\n            <span class="form__ingredient-chec"></span>\n            <span class="form__ingredient-name">${p.nothing}</span>\n        </div>\n    `),e.classList.add("active"),setTimeout(()=>{o.classList.add("active")},300);const g=document.querySelectorAll(".form__ingredient-el"),u=document.querySelector(".form__ingredient-el.nothing");let v=[];for(const e of g){const t=e.children[1].textContent;e.addEventListener("click",(function(){if(this.classList.toggle("active"),e.classList.contains("active"))if(e.classList.add("active"),t===p.nothing){v=[];for(const e of g)e.classList.remove("active");u.classList.add("active"),v.push(u.children[1].textContent)}else{u.classList.remove("active");const e=v.find(e=>e===p.nothing);e&&v.splice(v.indexOf(e),1),v.push(t)}else if(e.classList.remove("active"),t===p.nothing)v=[];else{const e=v.find(e=>e===t);e&&v.splice(v.indexOf(e),1)}s.setAttribute("value",v.join(", "))}))}},closeForm=(e,t,o,n,s,i)=>{o.classList.remove("active"),setTimeout(()=>{e.classList.remove("active"),setTimeout(()=>{n.setAttribute("value",""),s.setAttribute("value",""),t.textContent="",i.textContent=""},100)},300)},goodsCreateContent=(e,t)=>{e.classList.add("active");const o=document.querySelector(".app-touch-good__scroll");t(o,"Выбирай и готовь!"),o.insertAdjacentHTML("beforeend",'\n        <section class="app-touch-good__categories">\n            <div class="app-touch-good__categories-scroll"></div>\n        </section>\n        <section class="app-touch-good__goods">\n            <div class="app-touch-good__goods-wrap"></div>\n        </section>\n    ');const n=document.querySelector(".app-touch-good__categories-scroll"),s=document.querySelector(".app-touch-good__goods-wrap");appGetData("./db/categories.json").then(e=>{e.forEach((e,t)=>{1===++t?n.insertAdjacentHTML("beforeend",`<div class="app-touch-good__categories-el active" data-filter="${e.name}">\n                    <span>${e.name}</span>\n                </div>`):n.insertAdjacentHTML("beforeend",`<div class="app-touch-good__categories-el" data-filter="${e.name}">\n                    <span>${e.name}</span>\n                </div>`)})}),appGetData("./db/goods.json",s).then(e=>{e.forEach(e=>{const{id:t,name:o,nameMin:n,img:i,ingredients:a,category:c,time:d,main:l}=e;s.insertAdjacentHTML("beforeend",`\n                <div class="good" data-filter="${c}" data-name="${o}" data-ingredients="${a}" data-img="${i}" data-time="${d}">\n                    <div class="good__content">\n                        <div class="good__wrap-img">\n                            <img data-src="${i}" src="${contentApp.main.goods.loading}" alt="good-img-${t}" class="good__img">\n                            <span class="good__time">${d}</span>\n                        </div>\n                        <div class="good__wrap-text">\n                            <div class="good__name">${o}</div>\n                            <div class="good__choose">${contentApp.main.goods.choose}</div>\n                        </div>\n                    </div>\n                </div>\n            `)}),lazyLoading(o,"img[data-src]",windowHeight,"y")}),n.addEventListener("click",(function(e){const t=e.target.closest(".app-touch-good__categories-el");if(t){const e=document.querySelectorAll(".app-touch-good__categories-el"),n=document.querySelectorAll(".good"),s=t.dataset.filter;for(const t of e)t.classList.remove("active");t.classList.add("active"),o.scrollTop=0;for(const e of n)e.classList.remove("show"),e.classList.add("hide"),e.dataset.filter!==s&&"все"!==s||(e.classList.add("show"),e.classList.remove("hide"));lazyLoading(o,"img[data-src]",windowHeight,"y")}}),!1),e.addEventListener("click",(function(e){e.target.closest(".app-touch-back")&&(this.classList.remove("active"),o.textContent="")}),!1)},appLog=(e,t,o,n)=>{console.log(e),console.log(t),console.log(o),console.log(n)},appTouch=(e,t,o,n,s,i,a,c,d)=>{e(hideApp,showApp);const l=n(app,o,"div","app-touch","beforeend"),r=s(l,o,"main","app-touch-main","beforeend",contentApp.main),p=i(l,o,"div","app-touch-good","beforeend"),m=a(l,o,"div","app-touch-form","beforeend",contentApp.form),g=document.querySelector(".goods__scroll"),u=document.querySelector(".app-touch-main__section_goods"),v=document.querySelector(".form__good"),_=m.children[0],h=m.children[1],f=h,L=document.getElementById("form"),A=document.querySelector(".form__name-submit"),b=document.querySelector(".form__ingredients-submit"),w=document.querySelector(".form__ingredients");let y=null,$=null;var T,E,k,x;T=l,E=r,k=p,x=m,console.log(T),console.log(E),console.log(k),console.log(x),appGetData("./db/goods.json",g).then(e=>{e.forEach(e=>{const{id:t,name:o,nameMin:n,img:s,ingredients:i,category:a,time:c,main:d}=e,l=`\n                <div class="good" data-name="${o}" data-ingredients="${i}" data-img="${s}" data-time="${c}">\n                    <div class="good__content">\n                        <div class="good__wrap-img">\n                            <img data-src="${s}" src="${contentApp.main.goods.loading}" alt="good-img-${t}" class="good__img">\n                            <span class="good__time">${c}</span>\n                        </div>\n                        <div class="good__wrap-text">\n                            <div class="good__name">${o}</div>\n                            <div class="good__choose">${contentApp.main.goods.choose}</div>\n                        </div>\n                    </div>\n                </div>\n            `;""!==d&&g.insertAdjacentHTML("beforeend",l)}),console.log(":: In main",g.children.length,"elmenets"),lazyLoading(g,"img[data-src]",windowWidth,"x")}),u.addEventListener("click",(function(e){e.target.closest("#see-all-goods")&&goodsCreateContent(p,t)}),!1),l.addEventListener("click",(function(e){const t=e.target.closest(".good");if(t){const e=t.dataset.name,o=e.split(" <br> ").join(" "),n=t.dataset.ingredients,s=t.dataset.img,i=t.dataset.time,a=t.querySelector(".good__choose");a.classList.add("active"),setTimeout(()=>{a.classList.remove("active")},1e3),c(m,v,h,A,b,w,e,o,n,s,i,contentApp.form)}})),_.addEventListener("click",(function(){if(!this.nextElementSibling.classList.contains("active"))return!1;d(m,v,h,A,b,w)}),!1),f.addEventListener("touchstart",(function(e){const t=e.touches[0];y=t.clientX,$=t.clientY}),!1),f.addEventListener("touchmove",(function(e){if(!y||!$)return!1;const t=e.touches[0];let o=t.clientX,n=t.clientY,s=o-y,i=n-$;return Math.abs(i)>Math.abs(s)?(i>100&&(h.classList.add("swipe"),setTimeout(()=>{h.classList.remove("swipe")},100),i>300&&(h.classList.remove("swipe"),d(m,v,h,A,b,w))),!1):void 0}),!1),L.addEventListener("submit",(function(e){e.preventDefault(),alert("Этот функционал находится в разработке")})),window.addEventListener("resize",(function(e){document.documentElement.clientWidth>500?hideApp():showApp()}))},appDesktop=()=>console.log("desktop");touchScreen?appTouch(resizeApp,appBack,createElements,createAppTouch,createAppTouchMain,createAppTouchGoods,createAppTouchForm,openForm,closeForm):console.log("desktop");